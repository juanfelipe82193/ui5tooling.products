'use strict';
const
    deployer = require('./lib/deployer'),
    deployId = process.env.DEPLOY_ID || 'none',
    shouldExit = process.env.EXIT === '1';

function idle() {
    setTimeout(idle, 10 * 60 * 1000);
}

(async function deploy() {
    let exitCode = 0;
    try {
        let msg = await deployer.deploy();
        //message that deploy service is listening to to know when deployment is finished or failed
        console.log(`Deployment of site content to persistency done [Deployment Id:${deployId}], message: ${msg}`);
    } catch (err) {
        console.error(`Deployment of site content to persistency failed [Deployment Id:${deployId}] , ${err.message}`);
        exitCode = 1;
    }
    if (shouldExit) {
        process.exit(exitCode);
    }
    idle();
})();